const k=["twitter.com","facebook.com","instagram.com","reddit.com","youtube.com","tiktok.com"],x=window.location.hostname,b=k.some(n=>x.includes(n));b&&L();function L(){chrome.storage.local.get(["accessExpiry"],n=>{const c=Date.now();n.accessExpiry&&c<n.accessExpiry||C()})}function C(){window.stop(),document.documentElement.innerHTML="",fetch(chrome.runtime.getURL("src/content/overlay.html")).then(n=>n.text()).then(n=>{document.documentElement.innerHTML=n,S(),T()})}function S(){const n=document.createElement("link");n.href=chrome.runtime.getURL("src/content/overlay.css"),n.type="text/css",n.rel="stylesheet",document.head.appendChild(n)}function T(){const n=document.getElementById("fg-subject-select"),c=document.getElementById("fg-start-btn"),g=document.getElementById("fg-quiz-section"),p=document.getElementById("fg-subject-section"),u=document.getElementById("fg-question-text"),l=document.getElementById("fg-options");let d=[],i=0,r=0;chrome.storage.local.get(["studyData"],o=>{const t=Object.keys(o.studyData||{});if(t.length===0){n.innerHTML="<option disabled selected>No notes found. Go to Options!</option>",c.disabled=!0,c.textContent="Add Notes First";return}n.innerHTML='<option value="" disabled selected>Select a Subject</option>',t.forEach(e=>{const s=document.createElement("option");s.value=e,s.text=e,n.add(s)})}),c.addEventListener("click",()=>{const o=n.value;if(!o)return alert("Please select a subject!");c.textContent="Summoning AI...",c.disabled=!0,chrome.storage.local.get(["studyData","openaiKey","quizLength"],t=>{const e=t.studyData[o],s=t.openaiKey,E=t.quizLength||10;if(!s){alert("API Key missing! Check Extension Options."),c.disabled=!1;return}chrome.runtime.sendMessage({action:"GENERATE_QUIZ",notes:e,apiKey:s,qCount:E},a=>{c.disabled=!1,c.textContent="âš”ï¸ Challenge Gate",a&&a.success?(d=a.data,i=0,r=0,p.style.display="none",g.style.display="block",m()):alert("Failed to generate quiz: "+(a?a.error:"Unknown error"))})})});function m(){if(i>=d.length){f();return}const o=d[i];u.textContent=`${i+1}. ${o.question}`,l.innerHTML="",o.options.forEach(t=>{const e=document.createElement("button");e.textContent=t,e.onclick=()=>y(t,o.answer),l.appendChild(e)})}function y(o,t){o===t&&r++,i++,m()}function f(){const o=d.length,t=r/o*100;if(l.innerHTML="",t>=80)u.innerHTML=`
        <div style="color: #4ade80; font-size: 24px;">ðŸŽ‰ PASSED!</div>
        <p>Score: ${r}/${o} (${Math.round(t)}%)</p>
        <p>Access granted for 30 minutes.</p>
      `,setTimeout(()=>h(),2e3);else{u.innerHTML=`
        <div style="color: #ef4444; font-size: 24px;">â›” FAILED</div>
        <p>Score: ${r}/${o} (${Math.round(t)}%)</p>
        <p>You need 80% to pass. Go study!</p>
      `;const e=document.createElement("button");e.textContent="Try Again",e.style.marginTop="20px",e.style.padding="10px 20px",e.style.background="#ef4444",e.style.color="white",e.style.border="none",e.style.borderRadius="8px",e.style.cursor="pointer",e.onclick=()=>location.reload(),l.appendChild(e)}}function h(){const o=Date.now()+18e5;chrome.storage.local.get(["streak"],t=>{const e=(t.streak||0)+1;chrome.storage.local.set({accessExpiry:o,streak:e},()=>{location.reload()})})}chrome.storage.local.get(["streak"],o=>{const t=o.streak||0,e=document.getElementById("fg-streak");e&&(e.textContent=`Streak: ${t} ðŸ”¥`)})}
