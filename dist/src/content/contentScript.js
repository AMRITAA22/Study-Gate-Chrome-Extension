const k=["twitter.com","facebook.com","instagram.com","reddit.com","youtube.com","tiktok.com"],x=window.location.hostname,b=k.some(t=>x.includes(t));b&&C();function C(){chrome.storage.local.get(["accessExpiry"],t=>{const c=Date.now();t.accessExpiry&&c<t.accessExpiry||S()})}function S(){window.stop(),document.documentElement.innerHTML="",fetch(chrome.runtime.getURL("src/content/overlay.html")).then(t=>t.text()).then(t=>{document.documentElement.innerHTML=t,L(),w()})}function L(){const t=document.createElement("link");t.href=chrome.runtime.getURL("src/content/overlay.css"),t.type="text/css",t.rel="stylesheet",document.head.appendChild(t)}function w(){const t=document.getElementById("fg-subject-select"),c=document.getElementById("fg-start-btn"),g=document.getElementById("fg-quiz-section"),p=document.getElementById("fg-subject-section"),d=document.getElementById("fg-question-text"),l=document.getElementById("fg-options");let u=[],i=0,a=0;chrome.storage.local.get(["studyData"],n=>{const e=Object.keys(n.studyData||{});if(e.length===0){t.innerHTML="<option disabled selected>No notes found. Go to Options!</option>",c.disabled=!0,c.textContent="Add Notes First";return}t.innerHTML='<option value="" disabled selected>Select a Subject</option>',e.forEach(o=>{const s=document.createElement("option");s.value=o,s.text=o,t.add(s)})}),c.addEventListener("click",()=>{const n=t.value;if(!n)return alert("Please select a subject!");c.textContent="Summoning AI...",c.disabled=!0,chrome.storage.local.get(["studyData","openaiKey","quizLength"],e=>{const o=e.studyData[n],s=e.openaiKey,E=e.quizLength||10;if(!s){alert("API Key missing! Check Extension Options."),c.disabled=!1;return}chrome.runtime.sendMessage({action:"GENERATE_QUIZ",notes:o,apiKey:s,qCount:E},r=>{c.disabled=!1,c.textContent="âš”ï¸ Challenge Gate",r&&r.success?(u=r.data,i=0,a=0,p.style.display="none",g.style.display="block",m()):alert("Failed to generate quiz: "+(r?r.error:"Unknown error"))})})});function m(){if(i>=u.length){y();return}const n=u[i];d.textContent=`${i+1}. ${n.question}`,l.innerHTML="",n.options.forEach(e=>{const o=document.createElement("button");o.textContent=e,o.onclick=()=>f(e,n.answer),l.appendChild(o)})}function f(n,e){n===e&&a++,i++,m()}function y(){const n=u.length,e=a/n*100;if(l.innerHTML="",e>=80)d.innerHTML=`
        <div style="color: #4ade80; font-size: 24px; font-weight: 800; margin-bottom: 10px;">ðŸŽ‰ ACCESS GRANTED</div>
        <p>Score: ${a}/${n} (${Math.round(e)}%)</p>
        <p style="font-size: 14px; opacity: 0.8;">The gate opens for 30 minutes.</p>
      `,setTimeout(()=>h(),2e3);else{d.innerHTML=`
        <div style="color: #f87171; font-size: 24px; font-weight: 800; margin-bottom: 10px;">â›” ACCESS DENIED</div>
        <p>Score: ${a}/${n} (${Math.round(e)}%)</p>
        <p style="font-size: 14px; opacity: 0.8;">Required: 80%. Review your notes!</p>
      `;const o=document.createElement("button");o.innerHTML="<span>ðŸ”„ Retry Quiz</span>",o.className="fg-btn-danger",o.onclick=()=>location.reload(),l.appendChild(o)}}function h(){const n=Date.now()+18e5;chrome.storage.local.get(["streak"],e=>{const o=(e.streak||0)+1;chrome.storage.local.set({accessExpiry:n,streak:o},()=>{location.reload()})})}chrome.storage.local.get(["streak"],n=>{const e=n.streak||0,o=document.getElementById("fg-streak");o&&(o.textContent=`Streak: ${e} ðŸ”¥`)})}
